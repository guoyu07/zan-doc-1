<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <meta charset="utf-8"/>
    <title>API Documentation</title>
    <meta name="author" content=""/>
    <meta name="description" content=""/>

    <link href="../css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/prism.css" rel="stylesheet" media="all"/>
    <link href="../css/template.css" rel="stylesheet" media="all"/>
    
    <!--[if lt IE 9]>
    <script src="../js/html5.js"></script>
    <![endif]-->
    <script src="../js/jquery-1.11.0.min.js"></script>
    <script src="../js/ui/1.10.4/jquery-ui.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/jquery.smooth-scroll.js"></script>
    <script src="../js/prism.min.js"></script>
    <!-- TODO: Add http://jscrollpane.kelvinluck.com/ to style the scrollbars for browsers not using webkit-->
    <script type="text/javascript">
    function loadExternalCodeSnippets() {
        Array.prototype.slice.call(document.querySelectorAll('pre[data-src]')).forEach(function (pre) {
            var src = pre.getAttribute('data-src');
            var extension = (src.match(/\.(\w+)$/) || [, ''])[1];
            var language = 'php';

            var code = document.createElement('code');
            code.className = 'language-' + language;

            pre.textContent = '';

            code.textContent = 'Loading…';

            pre.appendChild(code);

            var xhr = new XMLHttpRequest();

            xhr.open('GET', src, true);

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {

                    if (xhr.status < 400 && xhr.responseText) {
                        code.textContent = xhr.responseText;

                        Prism.highlightElement(code);
                    }
                    else if (xhr.status >= 400) {
                        code.textContent = '✖ Error ' + xhr.status + ' while fetching file: ' + xhr.statusText;
                    }
                    else {
                        code.textContent = '✖ Error: File does not exist or is empty';
                    }
                }
            };

            xhr.send(null);
        });
    }

    $(document).ready(function(){
        loadExternalCodeSnippets();
    });
    $('#source-view').on('shown', function () {
        loadExternalCodeSnippets();
    })
</script>

    <link rel="shortcut icon" href="../images/favicon.ico"/>
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
</head>
<body>

<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <i class="icon-ellipsis-vertical"></i>
            </a>
            <a class="brand" href="../index.html">API Documentation</a>

            <div class="nav-collapse">
                <ul class="nav pull-right">
                                        <li class="dropdown" id="charts-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            Charts <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="../graphs/class.html">
                                    <i class="icon-list-alt"></i>&#160;Class hierarchy diagram
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown" id="reports-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            Reports <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="../reports/errors.html">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <i class="icon-list-alt"></i>&#160;Errors <span class="label label-info pull-right">0</span>
                                </a>
                            </li>
                            <li>
                                <a href="../reports/markers.html">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <i class="icon-list-alt"></i>&#160;Markers <span class="label label-info pull-right">0</span>
                                </a>
                            </li>
                            <li>
                                <a href="../reports/deprecated.html">
                                                                                                            <i class="icon-list-alt"></i>&#160;Deprecated <span class="label label-info pull-right">0</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!--<div class="go_to_top">-->
    <!--<a href="#___" style="color: inherit">Back to top&#160;&#160;<i class="icon-upload icon-white"></i></a>-->
    <!--</div>-->
</div>

<div id="___" class="container-fluid">
        <section class="row-fluid">
        <div class="span2 sidebar">
                                <div class="accordion" style="margin-bottom: 0">
        <div class="accordion-group">
            <div class="accordion-heading">
                                    <a class="accordion-toggle " data-toggle="collapse" data-target="#namespace-1915817557"></a>
                                <a href="../namespaces/default.html" style="margin-left: 30px; padding-left: 0">\</a>
            </div>
            <div id="namespace-1915817557" class="accordion-body collapse in">
                <div class="accordion-inner">

                    
                    <ul>
                                                                                                    <li class="class"><a href="../classes/swoole_buffer.html">swoole_buffer</a></li>
                                                    <li class="class"><a href="../classes/swoole_client.html">swoole_client</a></li>
                                                    <li class="class"><a href="../classes/swoole_connpool.html">swoole_connpool</a></li>
                                                    <li class="class"><a href="../classes/swoole_http_client.html">swoole_http_client</a></li>
                                                    <li class="class"><a href="../classes/swoole_http_request.html">swoole_http_request</a></li>
                                                    <li class="class"><a href="../classes/swoole_http_response.html">swoole_http_response</a></li>
                                                    <li class="class"><a href="../classes/swoole_http_server.html">swoole_http_server</a></li>
                                                    <li class="class"><a href="../classes/swoole_mysql.html">swoole_mysql</a></li>
                                                    <li class="class"><a href="../classes/swoole_process.html">swoole_process</a></li>
                                                    <li class="class"><a href="../classes/swoole_redis.html">swoole_redis</a></li>
                                                    <li class="class"><a href="../classes/swoole_server.html">swoole_server</a></li>
                                                    <li class="class"><a href="../classes/swoole_server_port.html">swoole_server_port</a></li>
                                                    <li class="class"><a href="../classes/swoole_timer.html">swoole_timer</a></li>
                                                    <li class="class"><a href="../classes/swoole_websocket_server.html">swoole_websocket_server</a></li>
                                            </ul>
                </div>
            </div>
        </div>
    </div>

        </div>
    </section>
    <section class="row-fluid">
        <div class="span10 offset2">
            <div class="row-fluid">
                <div class="span8 content class">
                    <nav>
                                                <a href="../namespaces/default.html">\</a> <i class="icon-level-up"></i>
                                            </nav>
                    <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal"><i class="icon-code"></i></a>

                    <h1><small>\</small>swoole_websocket_server</h1>
                    <p><em>class swoole_websocket_server extends swoole_http_server
继承自 swoole_http_server 类</em></p>
                    
                    
                                        
                    <section id="summary">
                        <h2>Summary</h2>
                        <section class="row-fluid heading">
                            <section class="span4">
                                <a href="#methods">Methods</a>
                            </section>
                            <section class="span4">
                                <a href="#properties">Properties</a>
                            </section>
                            <section class="span4">
                                <a href="#constants">Constants</a>
                            </section>
                        </section>
                        <section class="row-fluid public">
                            <section class="span4">
                                                                    <a href="../classes/swoole_websocket_server.html#method___construct" class="">__construct()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_on" class="">on()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_push" class="">push()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_exist" class="">exist()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_start" class="">start()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_listen" class="">listen()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_addlistener" class="">addlistener()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_set" class="">set()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_protect" class="">protect()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_sendfile" class="">sendfile()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_close" class="">close()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_task" class="">task()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_finish" class="">finish()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_reload" class="">reload()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_shutdown" class="">shutdown()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_stop" class="">stop()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_getLastError" class="">getLastError()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_heartbeat" class="">heartbeat()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_getClientInfo" class="">getClientInfo()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_getClientList" class="">getClientList()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_denyRequest" class="">denyRequest()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_sendMessage" class="">sendMessage()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_addProcess" class="">addProcess()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_stats" class="">stats()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_getSocket" class="">getSocket()</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#method_bind" class="">bind()</a><br />
                                                            </section>
                            <section class="span4">
                                                                    <a href="../classes/swoole_websocket_server.html#property_master_pid" class="">$master_pid</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#property_manager_pid" class="">$manager_pid</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#property_worker_pid" class="">$worker_pid</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#property_taskworker" class="">$taskworker</a><br />
                                                                    <a href="../classes/swoole_websocket_server.html#property_setting" class="">$setting</a><br />
                                                            </section>
                            <section class="span4">
                                                                    <em>No constants found</em>
                                                            </section>
                        </section>
                        <section class="row-fluid protected">
                            <section class="span4">
                                                                    <em>No protected methods found</em>
                                                            </section>
                            <section class="span4">
                                                                    <em>No protected properties found</em>
                                                            </section>
                            <section class="span4">
                                <em>N/A</em>
                            </section>
                        </section>
                        <section class="row-fluid private">
                            <section class="span4">
                                                                    <em>No private methods found</em>
                                                            </section>
                            <section class="span4">
                                                                    <em>No private properties found</em>
                                                            </section>
                            <section class="span4">
                                <em>N/A</em>
                            </section>
                        </section>
                    </section>
                </div>
                <aside class="span4 detailsbar">
                                        
                    
                    <dl>
                        <dt>File</dt>
                            <dd><a href="../files/swoole_websocket_server.html"><div class="path-wrapper">swoole_websocket_server.php</div></a></dd>
                                                <dt>Package</dt>
                            <dd><div class="namespace-wrapper">swoole_websocket_server</div></dd>
                                                <dt>Class hierarchy</dt>
                            <dd class="hierarchy">
                                                                                                                                                                    <div class="namespace-wrapper">\swoole_websocket_server</div>
                            </dd>

                        
                        
                        
                        
                                                                        </dl>
                    <h2>Tags</h2>
                    <table class="table table-condensed">
                                            <tr>
                            <th>
                                since
                            </th>
                            <td>
                                                                    
                                                            </td>
                        </tr>
                                        </table>
                </aside>
            </div>

                        
                                    <a id="properties" name="properties"></a>
            <div class="row-fluid">
                <div class="span8 content class">
                    <h2>Properties</h2>
                </div>
                <aside class="span4 detailsbar"></aside>
            </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="property_master_pid" name="property_master_pid" class="anchor"></a>
            <article class="property">
                <h3 class="public ">$master_pid</h3>
                <pre class="signature">$master_pid : integer</pre>
                <p><em></em></p>
                

                                <h4>Type</h4>
                integer
                &mdash; 前服务主进程 master 的 PID                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                        <dl>
                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr><td colspan="2"><em>None found</em></td></tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="property_manager_pid" name="property_manager_pid" class="anchor"></a>
            <article class="property">
                <h3 class="public ">$manager_pid</h3>
                <pre class="signature">$manager_pid : integer</pre>
                <p><em></em></p>
                

                                <h4>Type</h4>
                integer
                &mdash; 当前服务管理进程 manager 的 PID                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                        <dl>
                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr><td colspan="2"><em>None found</em></td></tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="property_worker_pid" name="property_worker_pid" class="anchor"></a>
            <article class="property">
                <h3 class="public ">$worker_pid</h3>
                <pre class="signature">$worker_pid : integer</pre>
                <p><em></em></p>
                

                                <h4>Type</h4>
                integer
                &mdash; 当前 Worker 进程的操作系统进程ID。与posix_getpid()的返回值相同。                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                        <dl>
                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr><td colspan="2"><em>None found</em></td></tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="property_taskworker" name="property_taskworker" class="anchor"></a>
            <article class="property">
                <h3 class="public ">$taskworker</h3>
                <pre class="signature">$taskworker : boolean</pre>
                <p><em></em></p>
                

                                <h4>Type</h4>
                boolean
                &mdash; true表示当前进程是Task工作进程，false表示当前进程是Worker进程                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                        <dl>
                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr><td colspan="2"><em>None found</em></td></tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="property_setting" name="property_setting" class="anchor"></a>
            <article class="property">
                <h3 class="public ">$setting</h3>
                <pre class="signature">$setting : array</pre>
                <p><em>swoole_server::set() 函数所设置的参数会保存到 swoole_server::$setting 属性上。在回调函数中可以访问运行参数的值。</em></p>
                

                                <h4>Type</h4>
                array
                &mdash; 数组，保存通过 set() 设置的参数属性列表                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                        <dl>
                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr><td colspan="2"><em>None found</em></td></tr>
                            </table>
        </aside>
    </div>

                                                            
                                    <a id="methods" name="methods"></a>
            <div class="row-fluid">
                <div class="span8 content class"><h2>Methods</h2></div>
                <aside class="span4 detailsbar"></aside>
            </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method___construct" name="method___construct" class="anchor"></a>
            <article class="method">
                <h3 class="public ">__construct()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">__construct(string  <span class="argument">$serv_host</span>, integer  <span class="argument">$serv_port</span>) </pre>
                <p><em>__construct swoole_http_server 构造函数</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>string</td>
                                <td>$serv_host </td>
                                <td><p>服务要监听的 ip 地址</p></td>
                            </tr>
                                                    <tr>
                                <td>integer</td>
                                <td>$serv_port </td>
                                <td><p>服务要监听的 port 端口</p></td>
                            </tr>
                                            </table>
                
                
                				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_on" name="method_on" class="anchor"></a>
            <article class="method">
                <h3 class="public ">on()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">on(string  <span class="argument">$event_name</span>, callable  <span class="argument">$callback</span>) : boolean</pre>
                <p><em>注册 Server 的事件回调函数</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>string</td>
                                <td>$event_name </td>
                                <td><p>事件名，不区分大小写</p>
<pre><code class="language-php">swoole_server 事件列表
Start    master 进程，master 进程启动后触发该事件
         函数原型：function onStart(swoole_server $server);
                           在此事件之前Swoole Server已进行了如下操作：
                           已创建了manager进程。
                           已创建了worker子进程。
                           已监听所有TCP/UDP端口。
                           已监听了定时器。
Shutdown master 进程，master 进程退出后触发该事件
         函数原型：function onShutdown(swoole_server $server);
                         在此之前Swoole Server已进行了如下操作：
                         已关闭所有线程。
                         已关闭所有worker进程。
                         已close所有TCP/UDP监听端口。
                         已关闭主Rector。
ManagerStart manager 进程，manager 进程启动后触发该事件
             函数原型：function onManagerStart(swoole_server $serv);
                         在这个回调函数中可以修改管理进程的名称
ManagerStop  manager 进程，manager 进程退出后触发该事件
             函数原型：function onManagerStop(swoole_server $serv);
WorkerError  manager 进程，worker 进程出错后触发该事件
             函数原型：function onWorkerError(
                                 swoole_server $serv,
                                 int $worker_id, int $worker_pid,
                                 int $exit_code, int $signal);
                              $worker_pid 是异常进程的ID。
                              $exit_code 退出的状态码，范围是 1 ～255。
                              $signal 进程退出的信号。
Connect  worker 进程，客户端连接后触发该事件
         函数原型：function onConnect(swoole_server $server,
                                    int $fd, int $from_id);
                          $server 是 swoole_server 对象。
                          $fd 是连接的文件描述符，发送数据/关闭连接时需要此参数。
                          $from_id 来自那个 Reactor 线程。
Receive  worker 进程，收到客户端发送的数据后触发该事件
         函数原型：function onReceive(swoole_server $server, int $fd,
                                    int $reactor_id, string $data);
                 $server 是 swoole_server 对象。
                 $fd 是连接的文件描述符，发送数据/关闭连接时需要此参数。
                 $from_id 来自那个 Reactor 线程。
                 $data 收到的数据

                 //receive 事件回调示例
                 $server-&gt;on('Receive',
                              function($serv, $fd, $from_id, $data) {
                               $serv-&gt;send($fd, 'Swoole: '.$data);
                             });
Close    worker 进程，客户端关闭连接后触发该事件
         函数原型：function onClose(swoole_server $server,
                                  int $fd, int $reactorId);
                         $server 是swoole_server对象。
                         $fd 是连接的文件描述符。
                         $reactorId 来自那个reactor线程。
Packet   worker 进程，Udp server 收到客户端发送数据后触发该事件
         函数原型：function onPacket(swoole_server $server, string $data,
                                   array $client_info);
                 $server，swoole_server对象。
                 $data，收到的数据内容，可能是文本或者二进制内容。
                 $client_info，客户端信息包括address/port/server_socket 3项数据。

Task     task 进程，worker 进程向 task 进程发送数据后触发该事件
         函数原型：function onTask(swoole_server $serv, int $task_id,
                                 int $src_worker_id, mixed $data);
                          $task_id       任务 id
                          $src_worker_id 发送数据的 worker_id
                          $data          要发送的数据

Finish   worker 进程，task 进程调用 finish 接口或 return，worker 进程触发该事件
         函数原型：function onFinish(swoole_server $serv,
                                   int $task_id, string $data)；
                          $task_id是任务的ID，
                          $data是任务处理的结果内容。

WorkerStart worker/task 进程，worker/task 进程启动后触发该事件
            函数原型：function onWorkerStart(swoole_server $server,
                                           int $worker_id)
            可以通过$worker_id参数的值，判断worker是普通worker还是task_worker。
            $worker_id&gt;= $serv-&gt;setting['worker_num'] 时表示这个进程是task_worker。
            $worker_id是一个 [0, $worker_num] 之间的数字，
            表示这个worker进程的ID，$worker_id和进程PID没有任何关系
WorkerStop  worker/task 进程，worker/task 进程退出后触发该事件
            函数原型：function onWorkerStop(swoole_server $server,
                                          int $worker_id);
                              $worker_id 退出进程的 id 号
PipeMessage worker/task 进程，调用 $server-&gt;sendMessage 接口后，收到消息的进程触发
            函数原型：function onPipeMessage(swoole_server $server,
                                           int $from_worker_id,
                                           string $message);
                              $from_worker_id 消息来自哪个进程
                              $message 消息内容

swoole_http_server 新增事件
Request   worker 进程，服务端收到一个完整的 http 请求后，调用此函数。
                      onRequest 回调会销毁 $request 和 $response 对象
$http_server-&gt;on('Request', function ($request, $response) {
     $response-&gt;end("&lt;h1&gt;Hello Swoole. #".rand(1000, 9999)."&lt;/h1&gt;");
});

swoole_websocket_server 独有事件：
HandShake worker 进程，WebSocket建立连接后进行握手。
                 WebSocket服务器已经内置了handshake，
                 如果用户希望自己进行握手处理，可以设置onHandShake事件回调函数。
          函数原型：function onHandShake(swoole_http_request $request,
                                       swoole_http_response $response);
          onHandShake事件回调是可选的；
          设置 onHandShake 回调函数后不会再触发 onOpen 事件，需要应用代码自行处理；
          onHandShake 函数必须返回true表示握手成功，返回其他值表示握手失败；
          内置的握手协议为Sec-WebSocket-Version: 13，低版本浏览器需要自行实现握手；

onOpen   worker 进程，当WebSocket客户端与服务器建立连接并完成握手后会回调此函数。
         函数原型：function onOpen(swoole_websocket_server $svr,
                                 swoole_http_request $req);
                 $req 是一个Http请求对象，包含了客户端发来的握手请求信息；
                 onOpen 事件函数中可以调用push向客户端发送数据或者调用close关闭连接；
                 onOpen 事件回调是可选的；

onMessage    worker 进程，必须设置onMessage回调，收到来自客户端的数据帧时会回调此函数
             函数原型：function onMessage(swoole_server $server,
                                        swoole_websocket_frame $frame);
             $frame 是swoole_websocket_frame对象，包含了客户端发来的数据帧信息；
             onMessage回调必须被设置，未设置服务器将无法启动；
             客户端发送的ping帧不会触发onMessage，底层会自动回复pong包；</code></pre></td>
                            </tr>
                                                    <tr>
                                <td>callable</td>
                                <td>$callback </td>
                                <td><p>发生 $event_name 事件时的回调函数</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>成功返回 true，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_push" name="method_push" class="anchor"></a>
            <article class="method">
                <h3 class="public ">push()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">push(string  <span class="argument">$data</span>, integer  <span class="argument">$opcode = 1</span>, boolean  <span class="argument">$finish = true</span>) : boolean</pre>
                <p><em>push  向对端推送数据，长度最大不得超过2M，只用于 websocket</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>string</td>
                                <td>$data </td>
                                <td><p>要发送的数据内容</p></td>
                            </tr>
                                                    <tr>
                                <td>integer</td>
                                <td>$opcode </td>
                                <td><p>[optional]  指定发送数据内容的格式，默认为文本 WEBSOCKET_OPCODE_TEXT_FRAME，值为 1。
发送二进制内容$opcode参数需要设置为WEBSOCKET_OPCODE_BINARY_FRAME，值为 2。</p></td>
                            </tr>
                                                    <tr>
                                <td>boolean</td>
                                <td>$finish </td>
                                <td><p>[optional]  一个message分为多个frame传输时，finish为 fakse 表示 message 未完，为 true 代表最后一个frame。</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>执行成功返回 true，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_exist" name="method_exist" class="anchor"></a>
            <article class="method">
                <h3 class="public ">exist()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">exist(integer  <span class="argument">$fd</span>) : boolean</pre>
                <p><em>exist 检测 $fd 对应的连接是否存在</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>integer</td>
                                <td>$fd </td>
                                <td><p>要检测的连接的 $fd</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>连接存在返回 true，不存在返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_start" name="method_start" class="anchor"></a>
            <article class="method">
                <h3 class="public ">start()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">start() : boolean</pre>
                <p><em>start 启动 Http 服务器</em></p>
                

                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>启动成功返回 true，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_listen" name="method_listen" class="anchor"></a>
            <article class="method">
                <h3 class="public ">listen()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">listen(string  <span class="argument">$host</span>, integer  <span class="argument">$port</span>, integer  <span class="argument">$sock_type</span>) : \swoole_server_port|false</pre>
                <p><em>增加一个Server要监听的端口</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>string</td>
                                <td>$host </td>
                                <td><p>要监听的ip地址</p></td>
                            </tr>
                                                    <tr>
                                <td>integer</td>
                                <td>$port </td>
                                <td><p>要监听的端口</p></td>
                            </tr>
                                                    <tr>
                                <td>integer</td>
                                <td>$sock_type </td>
                                <td><p>socket类型，参考构造函数中的 $sock_type</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    <a href="../classes/swoole_server_port.html">\swoole_server_port</a>|false
                                            &mdash; <p>成功返回 swoole_server_port 对象，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_addlistener" name="method_addlistener" class="anchor"></a>
            <article class="method">
                <h3 class="public ">addlistener()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">addlistener(string  <span class="argument">$host</span>, integer  <span class="argument">$port</span>, integer  <span class="argument">$sock_type</span>) : \swoole_server_port|false</pre>
                <p><em>增加一个Server要监听的端口，意义同 listen 接口</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>string</td>
                                <td>$host </td>
                                <td><p>要监听的ip地址</p></td>
                            </tr>
                                                    <tr>
                                <td>integer</td>
                                <td>$port </td>
                                <td><p>要监听的端口</p></td>
                            </tr>
                                                    <tr>
                                <td>integer</td>
                                <td>$sock_type </td>
                                <td><p>socket类型，参考构造函数中的 $sock_type</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    <a href="../classes/swoole_server_port.html">\swoole_server_port</a>|false
                                            &mdash; <p>成功返回 swoole_server_port 对象，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_set" name="method_set" class="anchor"></a>
            <article class="method">
                <h3 class="public ">set()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">set(array  <span class="argument">$zset</span>) : boolean</pre>
                <p><em>set 设置 swoole_websocket_server 的配置选项</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>array</td>
                                <td>$zset </td>
                                <td><p>数组，key-&gt;value 形式的配置项</p>
<pre><code class="language-php">参考 swoole_server-&gt;set 中配置选项，http_server 额外增加了如下配置：
upload_tmp_dir  设置上传文件的临时目录
http_parse_post 设置POST消息解析开关，选项为true时自动将Content-Type
                为x-www-form-urlencoded的请求包体解析到POST数组。
                设置为false时将关闭POST解析。</code></pre></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>成功返回true，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_protect" name="method_protect" class="anchor"></a>
            <article class="method">
                <h3 class="public ">protect()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">protect(integer  <span class="argument">$conn_fd</span>, boolean  <span class="argument">$is_protected = null</span>) : boolean</pre>
                <p><em>protect 从心跳管理中隔离连接，用于保护某些连接不被心跳线程切断</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>integer</td>
                                <td>$conn_fd </td>
                                <td><p>要保护的连接 $fd</p></td>
                            </tr>
                                                    <tr>
                                <td>boolean</td>
                                <td>$is_protected </td>
                                <td><p>[optional] 可选参数，默认为 true</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>成功返回 true，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_sendfile" name="method_sendfile" class="anchor"></a>
            <article class="method">
                <h3 class="public ">sendfile()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">sendfile(integer  <span class="argument">$conn_fd</span>, string  <span class="argument">$filename</span>) : boolean</pre>
                <p><em>sendfile 发送文件到 TCP 客户端连接</em></p>
                <pre><code class="language-php"> sendfile 函数调用 OS 提供的 sendfile 系统调用，由操作系统直接读取文件并写入 socket。
 sendfile 只有2次内存拷贝，使用此函数可以降低发送大量文件时操作系统的 CPU 和内存占用。</code></pre>

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>integer</td>
                                <td>$conn_fd </td>
                                <td><p>指定目的客户端</p></td>
                            </tr>
                                                    <tr>
                                <td>string</td>
                                <td>$filename </td>
                                <td><p>要发送的文件路径，如果文件不存在会返回 false</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>操作成功返回 true，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_close" name="method_close" class="anchor"></a>
            <article class="method">
                <h3 class="public ">close()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">close(integer  <span class="argument">$fd</span>, boolean  <span class="argument">$reset = false</span>) : boolean</pre>
                <p><em>close  关闭客户端连接</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>integer</td>
                                <td>$fd </td>
                                <td><p>要关闭的客户端连接</p></td>
                            </tr>
                                                    <tr>
                                <td>boolean</td>
                                <td>$reset </td>
                                <td><p>[optional] 是否强制关闭，默认为否，设置为 true 会强制关闭连接，丢弃发送队列中的数据</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>操作成功返回 true，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_task" name="method_task" class="anchor"></a>
            <article class="method">
                <h3 class="public ">task()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">task(mixed  <span class="argument">$data</span>, integer  <span class="argument">$worker_id</span>) : integer|boolean</pre>
                <p><em>task 非阻塞投递任务到task_worker 池子中，此函数是非阻塞的，执行完毕会立即返回，worker进程可以继续处理新的请求。</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>mixed</td>
                                <td>$data </td>
                                <td><p>非资源类型的任意 php 变量</p></td>
                            </tr>
                                                    <tr>
                                <td>integer</td>
                                <td>$worker_id </td>
                                <td><p>[optional]  可选参数，默认值为 -1。投递目标task_worker 进程id，默认 －1，设置范围 0 - (serv-&gt;task_worker_num -1)</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    integer|boolean
                                            &mdash; <p>调用成功，返回值为整数 $task_id，表示此任务的 ID。如果有 finish 回应，onFinish 回调中会携带 $task_id 参数
调用失败，返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_finish" name="method_finish" class="anchor"></a>
            <article class="method">
                <h3 class="public ">finish()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">finish(mixed  <span class="argument">$data</span>) : boolean</pre>
                <p><em>用于在 task 进程中通知 worker 进程，投递的任务已完成，此函数可以传递结果数据给 worker 进程</em></p>
                <pre><code class="language-php"> 要在 task 进程中调用 finish 函数，必须为 Server 设置 onFinish 回调函数。
 此函数只可用于 task 进程的 onTask 回调中
 在 task 进程中，return 数据同样会触发 onFinish 事件。</code></pre>

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>mixed</td>
                                <td>$data </td>
                                <td><p>task 进程要传递给 worker 进程的数据</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>成功返回 true，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_reload" name="method_reload" class="anchor"></a>
            <article class="method">
                <h3 class="public ">reload()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">reload() : boolean</pre>
                <p><em>reload  重启所有worker 进程</em></p>
                <pre><code>Reload操作只能重新载入Worker进程启动后加载的PHP文件，建议使用get_included_files函数来列出哪些文件是在WorkerStart之前就加载的PHP文件，
在此列表中的PHP文件，即使进行了reload操作也无法重新载入。比如要关闭服务器重新启动才能生效。</code></pre>

                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>调用成功返回 true，调用失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_shutdown" name="method_shutdown" class="anchor"></a>
            <article class="method">
                <h3 class="public ">shutdown()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">shutdown() : void</pre>
                <p><em>shutdown  关闭服务器，可以用在worker 进程内。向主进程发送SGITERM也可以实现关闭服务器。</em></p>
                

                
                
                				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_stop" name="method_stop" class="anchor"></a>
            <article class="method">
                <h3 class="public ">stop()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">stop() : boolean</pre>
                <p><em>stop  停止当前worker进程，并立即触发onWorkerStop回调函数，停止其它worker进程需要指定 $worker_id 的值。</em></p>
                

                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>调用成功返回 true，调用失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_getLastError" name="method_getLastError" class="anchor"></a>
            <article class="method">
                <h3 class="public ">getLastError()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">getLastError() : integer</pre>
                <p><em>getLastError 获取最近一次操作错误的错误码，业务代码中可以根据错误码类型执行不同的逻辑。</em></p>
                <pre><code> 常见发送失败错误
 1001 连接已经被Server端关闭了，出现这个错误一般是代码中已经执行了$serv-&gt;close()关闭了某个连接，但仍然调用$serv-&gt;send()向这个连接发送数据
 1002 连接已被Client端关闭了，Socket已关闭无法发送数据到对端
 1003 正在执行close，onClose回调函数中不得使用$serv-&gt;send()
 1004 连接已关闭
1005 连接不存在，传入$fd 可能是错误的
1007 接收到了超时的数据，TCP关闭连接后，可能会有部分数据残留在管道缓存区内，这部分数据会被丢弃
1008 发送缓存区已满无法执行send操作，出现这个错误表示这个连接的对端无法及时收数据导致发送缓存区已塞满
常见发送失败错误</code></pre>

                
                
                                    <h4>Returns</h4>
                    integer
                                            &mdash; <p>返回一个整型数字错误码</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_heartbeat" name="method_heartbeat" class="anchor"></a>
            <article class="method">
                <h3 class="public ">heartbeat()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">heartbeat(boolean  <span class="argument">$if_close_connection = false</span>) : void</pre>
                <p><em>检测服务器所有连接，并找出已经超过约定时间的连接。
如果if_close_connection=true，则自动关闭超时的连接。否则仅返回连接的fd数组。</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>boolean</td>
                                <td>$if_close_connection </td>
                                <td><p>[optional] 可选参数，默认为 false，</p></td>
                            </tr>
                                            </table>
                
                
                				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_getClientInfo" name="method_getClientInfo" class="anchor"></a>
            <article class="method">
                <h3 class="public ">getClientInfo()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">getClientInfo(integer  <span class="argument">$fd</span>, integer  <span class="argument">$from_id</span>) : array|false</pre>
                <p><em>该函数用来获取连接的信息</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>integer</td>
                                <td>$fd </td>
                                <td><p>woker 进程的编号</p></td>
                            </tr>
                                                    <tr>
                                <td>integer</td>
                                <td>$from_id </td>
                                <td><p>[optional] 可选参数，若设置该参数，则只获取通过 reactor 线程 id 为 $from_id 的连接信息</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    array|false
                                            &mdash; <p>如果传入的 fd 存在，将会返回一个数组。如果传入的 fd 不存在或已关闭，返回 false。</p>
<pre><code>Array
(
[server_fd] =&gt; 3
[socket_type] =&gt; 1
[server_port] =&gt; 9501
[remote_port] =&gt; 56119
[remote_ip] =&gt; 127.0.0.1
[from_id] =&gt; 0
[connect_time] =&gt; 1495691486
[last_time] =&gt; 1495691486
)</code></pre>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_getClientList" name="method_getClientList" class="anchor"></a>
            <article class="method">
                <h3 class="public ">getClientList()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">getClientList(integer  <span class="argument">$start_fd</span>, integer  <span class="argument">$find_count</span>) : array|false</pre>
                <p><em>遍历当前Server所有的客户端连接，getClientList 方法是基于共享内存的，不存在IOWait，遍历的速度很快。
另外 getClientList 会返回所有 TCP 连接，而不仅仅是当前 worker 进程的 TCP 连接。</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>integer</td>
                                <td>$start_fd </td>
                                <td><p>[optional] 起始 $fd，默认是 0</p></td>
                            </tr>
                                                    <tr>
                                <td>integer</td>
                                <td>$find_count </td>
                                <td><p>[optional] 每页取多少条，默认是 10，最大值不得超过 SW_MAX_FIND_COUNT，即100</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    array|false
                                            &mdash; <p>调用成功返回一个数字索引，元素是取到的 $fd。数组会按从小到大排序，
最后一个 $fd 作为新的 start_fd 再次尝试获取，调用失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_denyRequest" name="method_denyRequest" class="anchor"></a>
            <article class="method">
                <h3 class="public ">denyRequest()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">denyRequest(integer  <span class="argument">$worker_id</span>) : boolean|void</pre>
                <p><em>denyRequest id 号为 $worker_id 的 worker 进程不再接收新的请求</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>integer</td>
                                <td>$worker_id </td>
                                <td><p>指定worker 进程 id</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    boolean|void
                                            &mdash; <p>失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_sendMessage" name="method_sendMessage" class="anchor"></a>
            <article class="method">
                <h3 class="public ">sendMessage()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">sendMessage(string  <span class="argument">$msg</span>, integer  <span class="argument">$work_id</span>) : boolean</pre>
                <p><em>向任意 worker 进程或着 tasker 进程发送消息。不能在主进程和管理进程中使用，收到消息的进程会触发 onPipeMessage 事件</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>string</td>
                                <td>$msg </td>
                                <td><p>要发送的消息内容</p></td>
                            </tr>
                                                    <tr>
                                <td>integer</td>
                                <td>$work_id </td>
                                <td><p>目标进程 id，范围是0 ~ (worker_num + task_worker_num - 1)</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>成功返回 true，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_addProcess" name="method_addProcess" class="anchor"></a>
            <article class="method">
                <h3 class="public ">addProcess()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">addProcess() : integer|false</pre>
                <p><em>addProcess  添加一个用户自定义的工作进程</em></p>
                

                
                
                                    <h4>Returns</h4>
                    integer|false
                                            &mdash; <p>成功返回该工作进程的 worker id，失败返回false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_stats" name="method_stats" class="anchor"></a>
            <article class="method">
                <h3 class="public ">stats()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">stats() : array</pre>
                <p><em>stats 统计当前server 活动tcp 的连接数／启动时间／接受、关闭次数等信息</em></p>
                

                
                
                                    <h4>Returns</h4>
                    array
                                            &mdash; <p>返回 server 的统计信息，示例如下：</p>
<pre><code class="language-php">Array
(
[start_time] =&gt; 1495680500
[connection_num] =&gt; 1
[accept_count] =&gt; 1
[close_count] =&gt; 0
[tasking_num] =&gt; 0
[request_count] =&gt; 0
[worker_request_count] =&gt; 0
)</code></pre>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_getSocket" name="method_getSocket" class="anchor"></a>
            <article class="method">
                <h3 class="public ">getSocket()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">getSocket(integer  <span class="argument">$port</span>) : resource</pre>
                <p><em>getSocket 获取监听套接字的socket句柄
此方法需要依赖PHP的sockets扩展，并且编译swoole时需要开启--enable-sockets选项</em></p>
                

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>integer</td>
                                <td>$port </td>
                                <td><p>[optional] 指定端口，不填表示不指定，则取第一个监听的套接字</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    resource
                                            &mdash; <p>返回 sockets 资源句柄</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                    <div class="row-fluid">
        <div class="span8 content class">
            <a id="method_bind" name="method_bind" class="anchor"></a>
            <article class="method">
                <h3 class="public ">bind()</h3>
                <a href="#source-view" role="button" class="pull-right btn" data-toggle="modal" style="font-size: 1.1em; padding: 9px 14px"><i class="icon-code"></i></a>
                <pre class="signature" style="margin-right: 54px;">bind(integer  <span class="argument">$fd</span>, integer  <span class="argument">$uid</span>) : boolean</pre>
                <p><em>bind 将连接 $fd 绑定到用户自定义$uid,设置 dispatch_mode=5，设置此 $uid 值进行 hash 固定分配，
可以保证某一个 $uid 的连接全部会分配到同一个Worker进程。</em></p>
                <pre><code>在默认的dispatch_mode=2设置下，server会按照socket fd来分配连接数据到不同的worker。
因为fd是不稳定的，一个客户端断开后重新连接，fd会发生改变。这样这个客户端的数据就会被分配到别的Worker。
使用bind之后就可以按照用户定义的ID进行分配。即使断线重连，相同uid的TCP连接数据会被分配相同的Worker进程。</code></pre>

                                    <h4>Parameters</h4>
                    <table class="table table-condensed table-hover">
                                                    <tr>
                                <td>integer</td>
                                <td>$fd </td>
                                <td><p>要连接的文件描述符</p></td>
                            </tr>
                                                    <tr>
                                <td>integer</td>
                                <td>$uid </td>
                                <td><p>用户自定义的 UID</p></td>
                            </tr>
                                            </table>
                
                
                                    <h4>Returns</h4>
                    boolean
                                            &mdash; <p>成功返回 true，失败返回 false</p>
                                    				
                            </article>
        </div>
        <aside class="span4 detailsbar">
            <h1><i class="icon-arrow-down"></i></h1>
                                                            <dl>
                                                                            </dl>
            <h2>Tags</h2>
            <table class="table table-condensed">
                                    <tr>
                        <th>
                            since
                        </th>
                        <td>
                                                            3.1.0                                
                                                    </td>
                    </tr>
                            </table>
        </aside>
    </div>

                                                                    </div>
    </section>

    <div id="source-view" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="source-view-label" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="source-view-label">swoole_websocket_server.php</h3>
        </div>
        <div class="modal-body">
            <pre data-src="../files/swoole_websocket_server.php.txt" class="language-php line-numbers"></pre>
        </div>
    </div>

    <footer class="row-fluid">
        <section class="span10 offset2">
            <section class="row-fluid">
                <section class="span10 offset1">
                    <section class="row-fluid footer-sections">
                        <section class="span4">
                                                        <h1><i class="icon-code"></i></h1>
                            <div>
                                <ul>
                                                                    </ul>
                            </div>
                        </section>
                        <section class="span4">
                                                        <h1><i class="icon-bar-chart"></i></h1>
                            <div>
                                <ul>
                                    <li><a href="../graphs/class.html">Class Hierarchy Diagram</a></li>
                                </ul>
                            </div>
                        </section>
                        <section class="span4">
                                                        <h1><i class="icon-pushpin"></i></h1>
                            <div>
                                <ul>
                                    <li><a href="../reports/errors.html">Errors</a></li>
                                    <li><a href="../reports/markers.html">Markers</a></li>
                                </ul>
                            </div>
                        </section>
                    </section>
                </section>
            </section>
            <section class="row-fluid">
                <section class="span10 offset1">
                    <hr />
                    Documentation is powered by <a href="http://www.phpdoc.org/">phpDocumentor </a> and authored
                    on July 20th, 2017 at 02:23.
                </section>
            </section>
        </section>
    </footer>
</div>

</body>
</html>
